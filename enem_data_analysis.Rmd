---
title: "ME115 - Linguagem R"
author: 
  - Guilherme Artoni - RA160318
  - Isabel A. de Albuquerque - RA218047
  - Isabella G. Alves - RA175293
  - Nathalia C. Chenfer - RA222803
bibliography: referencia.bib
output: 
  bookdown::pdf_document2:
    toc: FALSE
  fig_crop: no
fontsize: 10pt
sansfont: Times
documentclass: article
geometry: 
 - a4paper
 - textwidth=18cm
 - textheight=21cm
header-includes:
  - \usepackage[utf8]{inputenc}
  - \usepackage[brazil, english, portuguese]{babel}
  - \usepackage[utf8]{inputenc}
  - \usepackage[T1]{fontenc}
  - \usepackage[fixlanguage]{babelbib}
  - \usepackage{times}

  - \usepackage{graphicx}
  - \usepackage{wrapfig}
  - \usepackage{pdfpages}
  
  - \usepackage{amsfonts}
  - \usepackage{amssymb}
  - \usepackage{amsmath}
  
  - \usepackage{fancyhdr}
  - \usepackage{subcaption}
  - \usepackage{booktabs}
  - \usepackage{caption}
  - \usepackage{float}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE,error = FALSE)
options(knitr.table.format = "latex")
```

```{r}
library(tidyverse)
library(data.table)
library(xtable)
library(knitr)
library(nlme)
library(GGally)
library(PerformanceAnalytics)
library(MASS)
library(vcdExtra)
library(lme4)
library(splitstackshape)
library(Matrix)
library(VGAM)
library(nnet)
library(kableExtra)
library(reshape2)
```

# Introdução

desempenho médio dos estudantes de escolas particulares ($DM_{Part}$)
desempenho médio dos estudantes de escolas públicas ($DM_{Pub}$)
Ciências da Natureza (CN)
Ciências Humanas (CH)
Linguagens e Códigos (LC)
Matemática (MT)

# Banco de dados

A base de dados completa assim como demais informações sobre as edições do ENEM por escola podem ser acessada através do link: [\underline{ENEM por escola}](http://portal.inep.gov.br/microdados). Embora a base completa possui um total de 27 variáveis utilizaremos apenas as que estão descritas abaixo:

* **NU_ANO**: Ano da edição do ENEM por Escola;

* **TP_DEPENDENCIA_ADM_ESCOLA**: Tipo da dependência administrativa da Escola;

* **NU_MEDIA_CN**: Média das notas de Ciências da Natureza;

* **NU_MEDIA_CH**: Média das notas de Ciências Humanas;

* **NU_MEDIA_LP**: Média das notas de Linguagens e Códigos;

* **NU_MEDIA_MT**: Média das notas de Matemática;

* **NU_MEDIA_RED**: Média das notas de Redação.

Ressaltamos que para a realização da análise modificamos a variável **TP_DEPENDENCIA_ADM_ESCOLA** que originalmente é codificada como: 1 - Federal, 2 - Estadual, 3 - Municipal e 4 - Privada para 1 - Privada e 2 - Pública. De modo que as categorias administrativas Federal, Estadual e Municipal foram unificadas na categoria Pública.  
Além disso, restringimos a análise ao período entre os anos de 2011 a 2015. Pois, segundo @inep a partir da edição de 2011 a taxa de participação necessária para divulgação do desempenho no ENEM por escola aumentou para 50$\%$. Sendo que, a taxa de participação é o número total de participantes no ENEM da escola dividido pelo número de matriculados nos anos finais do Ensino Médio da escola, informado no Censo Escolar. Bem como, passou a ser considerado como participante o estudante concluinte do ensino médio que fez as 4 áreas de conhecimento e redação. Dessa forma, não havendo mais escolas com resultado divulgado sem média das notas de redação.

# Analise exploratória

```{r}
# ALTERAR O CAMINHO PARA O DIRETORIO NO QUAL O ARQUIVO "MICRODADOS_ENEM_ESCOLA.csv" 
# ESTA SALVO NO SEU COMPUTADOR
# NAO SALVE OS DADOS NO MESMO DIRETORIO QUE ESTA O ARQUIVO enem_data_analysis.Rmd
# QUE FOI IMPORTADO DO GITHUB

# IMPORTA OS DADOS
escolas <- read.csv("~/Downloads/undergraduate/1sem20/ME115/last_job/enem/microdados_enem_por_escola/DADOS/MICRODADOS_ENEM_ESCOLA.csv", sep = ";")

# TRANSFORMA A VARIAVEL SOBRE DEPENDENCIA ADMINISTRATIVA EM FATOR
escolas$TP_DEPENDENCIA_ADM_ESCOLA <- if_else(escolas$TP_DEPENDENCIA_ADM_ESCOLA == 4,
                                             "Privada","Pública")
escolas$TP_DEPENDENCIA_ADM_ESCOLA <- as.factor(escolas$TP_DEPENDENCIA_ADM_ESCOLA)

# FILTRA OS DADOS DE 2011 A 2015
escolas <- escolas %>% filter(NU_ANO > 2010)

# ALTERA OS NOMES DAS COLUNAS QUE APARECERAM NAS TABELAS
colnames(escolas) <- ifelse(colnames(escolas) == "NU_ANO",
                            "Ano",colnames(escolas))
colnames(escolas) <- ifelse(colnames(escolas) == "TP_DEPENDENCIA_ADM_ESCOLA",
                            "Administração",colnames(escolas))
```

Dada a forma como estruturamos os dados descrita na seção Banco de dados obtemos `r table(escolas$Administração == "Pública")[2]` observações de escolas públicas e `r table(escolas$Administração == "Privada")[2]` observações de escolas privadas que participaram das edições de 2011 a 2015 do ENEM por escola.

Considerando as informações sobre as notas médias em CN presentes na Tabela \@ref(tab:CN) podemos observar que em todos os anos o $DM_{Part}$ se sobressai em relação ao $DM_{Pub}$. Chama atenção o fato de que em todo o período 75$\%$ do $DM_{Pub}$ ficou abaixo de 500 pontos, sendo que em `r escolas %>% filter(Administração == "Pública") %>% group_by(Ano) %>% summarize(qtl = quantile(NU_MEDIA_CN,0.75,na.rm = T)) %>% filter(qtl == max(qtl)) %>% dplyr::select(Ano) %>% pull()` ano de melhor resultado foi registrado que 75$\%$ do $DM_{Pub}$ ficou abaixo de `r escolas %>% filter(Administração == "Pública") %>% group_by(Ano) %>% summarize(qtl = quantile(NU_MEDIA_CN,0.75,na.rm = T)) %>% filter(qtl == max(qtl)) %>% dplyr::select(qtl) %>% pull()` pontos. Em contraste, em `r escolas %>% filter(Administração == "Privada") %>% group_by(Ano) %>% summarize(qtl = round(quantile(NU_MEDIA_CN,0.25,na.rm = T),2)) %>% filter(qtl == min(qtl)) %>% dplyr::select(Ano) %>% pull()` ano de pior resultado foi registrado que 75$\%$ do $DM_{Part}$ ficou acima dos `r escolas %>% filter(Administração == "Privada") %>% group_by(Ano) %>% summarize(qtl = round(quantile(NU_MEDIA_CN,0.25,na.rm = T),2)) %>% filter(qtl == min(qtl)) %>% dplyr::select(qtl) %>% pull()` pontos. Em outras palavras, para os anos de 2011 a 2015, dentre os 25$\%$ dos piores resultados do $DM_{Part}$ em CN foram registradas pontuações melhores do que 75$\%$ do $DM_{Pub}$.  
Além disso, ainda na Tabela \@ref(tab:CN) observa-se que as medidas de posição central Média e Mediana possuem valores muito próximos em cada ano, um forte indício de simetria nas distribuições dos dados. Bem como, nota-se que os desvios-padrões dos $DM_{Pub}$ são menores do que os do $DM_{Part}$ em todo o período, indicando que as distribuições dos $DM_{Pub}$ se concentram mais em torno da média enquanto que as distribuições do $DM_{Part}$ possuem uma maior variabilidade.  
De modo geral, desde 2011 a 2015 todas as medidas das distribuições em cada categoria administrativa permaneceram muito próximas. Isso nos mostra que durante estes 5 anos não houve uma mudança significativa tanto no $DM_{Part}$ quanto no $DM_{Pub}$ em relação a CN. Fato que fica evidente quando olhamos para a Figura \@ref(fig:plot) na qual é mostrada em cor vermelha as distribuições amostrais do $DM_{Part}$ e $DM_{Pub}$ para cada ano. Estas estão quase que alinhadas umas sobre as outras e são muito semelhantes em todos os anos para cada categoria administrativa.

```{r CN}
#TABELA RESUMO DOS VALORES OBSERVADOS DA VARIAVEL NOTAS MEDIAS EM CIENCIAS DA NATUREZA
escolas %>% group_by(Ano,`Administração`) %>%
  summarize(Mínimo = min(NU_MEDIA_CN,na.rm = T),
            `1ºQuartil` = round(quantile(NU_MEDIA_CN, 0.25,na.rm = T),2),
            Mediana = round(median(NU_MEDIA_CN,na.rm = T),2),
            Média = round(mean(NU_MEDIA_CN,na.rm = T),2),
            `3ºQuartil` = round(quantile(NU_MEDIA_CN,0.75,na.rm = T),2),
            Máximo = max(NU_MEDIA_CN,na.rm = T),
            `Desvio Padrão` = round(sd(NU_MEDIA_CN,na.rm = T),2)
            ) %>% 
  kable(booktabs = TRUE, 
        caption = "Comparação entre os anos de 2011 a 2015 das medidas resumo das notas médias em Ciências da Natureza considerando as categorias administrativas das escolas.") %>%
  kable_styling(latex_options = "HOLD_position",
                font_size = 8) %>% 
  kable_styling(latex_options = "scale_down")
```

```{r CH}
#TABELA RESUMO DOS VALORES OBSERVADOS DA VARIAVEL NOTAS MEDIAS EM CIENCIAS HUMANAS
escolas %>% group_by(Ano,`Administração`) %>%
  summarize(Mínimo = min(NU_MEDIA_CH,na.rm = T),
            `1ºQuartil` = round(quantile(NU_MEDIA_CH, 0.25,na.rm = T),2),
            Mediana = round(median(NU_MEDIA_CH,na.rm = T),2),
            Média = round(mean(NU_MEDIA_CH,na.rm = T),2),
            `3ºQuartil` = round(quantile(NU_MEDIA_CH,0.75,na.rm = T),2),
            Máximo = max(NU_MEDIA_CH,na.rm = T),
            `Desvio Padrão` = round(sd(NU_MEDIA_CH,na.rm = T),2)
            ) %>% 
  kable(booktabs = TRUE, 
        caption = "Comparação entre os anos de 2011 a 2015 das medidas resumo das notas médias em Ciências Humanas considerando as categorias administrativas das escolas.") %>%
  kable_styling(latex_options = "HOLD_position",
                font_size = 8) %>% 
  kable_styling(latex_options = "scale_down")
```

```{r LP}
#TABELA RESUMO DOS VALORES OBSERVADOS DA VARIAVEL NOTAS MEDIAS EM LINGUAGENS E CODIGOS
escolas %>% group_by(Ano,`Administração`) %>%
  summarize(Mínimo = min(NU_MEDIA_LP,na.rm = T),
            `1ºQuartil` = round(quantile(NU_MEDIA_LP, 0.25,na.rm = T),2),
            Mediana = round(median(NU_MEDIA_LP,na.rm = T),2),
            Média = round(mean(NU_MEDIA_LP,na.rm = T),2),
            `3ºQuartil` = round(quantile(NU_MEDIA_LP,0.75,na.rm = T),2),
            Máximo = max(NU_MEDIA_LP,na.rm = T),
            `Desvio Padrão` = round(sd(NU_MEDIA_LP,na.rm = T),2)
            ) %>% 
  kable(booktabs = TRUE, 
        caption = "Comparação entre os anos de 2011 a 2015 das medidas resumo das notas médias em Linguagens e Códigos considerando as categorias administrativas das escolas.") %>%
  kable_styling(latex_options = "HOLD_position",
                font_size = 8) %>% 
  kable_styling(latex_options = "scale_down")
```

```{r MT}
#TABELA RESUMO DOS VALORES OBSERVADOS DA VARIAVEL NOTAS MEDIAS EM MATEMATICA
escolas %>% group_by(Ano,`Administração`) %>%
  summarize(Mínimo = min(NU_MEDIA_MT,na.rm = T),
            `1ºQuartil` = round(quantile(NU_MEDIA_MT, 0.25,na.rm = T),2),
            Mediana = round(median(NU_MEDIA_MT,na.rm = T),2),
            Média = round(mean(NU_MEDIA_MT,na.rm = T),2),
            `3ºQuartil` = round(quantile(NU_MEDIA_MT,0.75,na.rm = T),2),
            Máximo = max(NU_MEDIA_MT,na.rm = T),
            `Desvio Padrão` = round(sd(NU_MEDIA_MT,na.rm = T),2)
            ) %>% 
  kable(booktabs = TRUE, 
        caption = "Comparação entre os anos de 2011 a 2015 das medidas resumo das notas médias em Matemática considerando as categorias administrativas das escolas.") %>%
  kable_styling(latex_options = "HOLD_position",
                font_size = 8) %>% 
  kable_styling(latex_options = "scale_down")
```

```{r RED}
#TABELA RESUMO DOS VALORES OBSERVADOS DA VARIAVEL NOTAS MEDIAS NA REDACAO
escolas %>% group_by(Ano,`Administração`) %>%
  summarize(Mínimo = min(NU_MEDIA_RED,na.rm = T),
            `1ºQuartil` = round(quantile(NU_MEDIA_RED, 0.25,na.rm = T),2),
            Mediana = round(median(NU_MEDIA_RED,na.rm = T),2),
            Média = round(mean(NU_MEDIA_RED,na.rm=T),2),
            `3ºQuartil` = round(quantile(NU_MEDIA_RED,0.75,na.rm = T),2),
            Máximo = max(NU_MEDIA_RED,na.rm = T),
            `Desvio Padrão` = round(sd(NU_MEDIA_RED,na.rm = T),2)
            ) %>% 
  kable(booktabs = TRUE, 
        caption = "Comparação entre os anos de 2011 a 2015 das medidas resumo das notas médias na Redação considerando as categorias administrativas das escolas.") %>%
  kable_styling(latex_options = "HOLD_position",
                font_size = 8) %>% 
  kable_styling(latex_options = "scale_down")
```

```{r include=FALSE}
# PREPARA DOS DADOS PARA GERAR OS GRAFICOS
data <- escolas %>% 
  dplyr::select(NU_MEDIA_CN,
                NU_MEDIA_CH,
                NU_MEDIA_LP,
                NU_MEDIA_MT,
                NU_MEDIA_RED) %>% t() %>% as.data.frame() 
data$Habilidades <- ifelse(row.names(data) == "NU_MEDIA_CN","Ciências da Natureza",
                           ifelse(row.names(data) == "NU_MEDIA_CH","Ciências Humanas",
                                  ifelse(row.names(data) == "NU_MEDIA_LP","Linguagens e Códigos",
                                         ifelse(row.names(data) == "NU_MEDIA_MT","Matemática","Redação"))))
data <- melt(data,id="Habilidades")
data$`Administração` <- rep(escolas$Administração,rep(5,length(escolas$Administração)))
data$Ano <- rep(escolas$Ano,rep(5,length(escolas$Ano)))
```

```{r plot, fig.align='center', fig.cap="Comparação das distribuições amostrais das notas médias obtidas no ENEM por estudantes de escolas públicas e privadas entre os anos de 2011 a 2015, considerando as habilidades exigidas.",fig.pos="H", message=FALSE, error=FALSE}

data %>% 
  ggplot() + 
  aes(x=value, 
      color=Habilidades) + 
  geom_density() +
  facet_grid(Ano~Administração,scales = "free") +
  theme_minimal() + 
  theme(axis.text.x = element_text(size = 8),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 8),
        title = element_text(size = 9)) +
  ggtitle("Distribuições amostrais das notas médias obtidas no ENEM\nentre os anos de 2011 a 2015 de estudantes de escolas públicas e privadas ") +
  xlab("Notas médias") + 
  ylab("Densidades")
```

# Considerações finais

# Referências