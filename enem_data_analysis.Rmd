---
title: "ME115 - Linguagem R"
author: 
  - Guilherme Artoni - RA160318
  - Isabel A. de Albuquerque - RA218047
  - Isabella G. Alves - RA175293
  - Nathalia C. Chenfer - RA222803
bibliography: referencia.bib
output: 
  pdf_document:
  fig_crop: no
fontsize: 10pt
sansfont: Times
documentclass: article
geometry: 
 - a4paper
 - textwidth=18cm
 - textheight=21cm
header-includes:
  - \usepackage[utf8]{inputenc}
  - \usepackage[brazil, english, portuguese]{babel}
  - \usepackage[utf8]{inputenc}
  - \usepackage[T1]{fontenc}
  - \usepackage[fixlanguage]{babelbib}
  - \usepackage{times}

  - \usepackage{graphicx}
  - \usepackage{wrapfig}
  - \usepackage{pdfpages}
  
  - \usepackage{amsfonts}
  - \usepackage{amssymb}
  - \usepackage{amsmath}
  
  - \usepackage{fancyhdr}
  - \usepackage{subcaption}
  - \usepackage{booktabs}
  - \usepackage{caption}
  - \usepackage{float}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE,error = FALSE)
```

```{r}
library(tidyverse)
library(data.table)
library(xtable)
library(knitr)
library(nlme)
library(GGally)
library(PerformanceAnalytics)
library(MASS)
library(vcdExtra)
library(lme4)
library(splitstackshape)
library(Matrix)
library(VGAM)
library(nnet)
library(kableExtra)
library(reshape2)
```

# Introdução

Segundo @inep o número de bla bla bla

O grupo autor deste trabalho escolheu uma base de dados disponibilizada pelo Instituto Nacional de Estudos e Pesquisas Educacionais Anísio Teixeira (INEP) que contém dados sobre diversas escolas do Brasil com alunos que participaram do Exame Nacional do Ensino Médio (ENEM).
O grupo tem o interesse de verificar:  
- "se escolas privadas são estritamente melhores do que as públicas".

# Banco de dados

A base de dados completa assim como demais informações sobre as edições do ENEM por escola podem ser acessada através do link: [\underline{ENEM por escola}](http://portal.inep.gov.br/microdados). Embora a base completa possuir um total de 27 variáveis utilizaremos apenas as que estão descritas abaixo:

* **NU_ANO**: Ano da edição do ENEM por Escola;

* **TP_DEPENDENCIA_ADM_ESCOLA**: Tipo da dependência administrativa da Escola;

* **NU_MEDIA_CN**: Média das notas de Ciências da Natureza;

* **NU_MEDIA_CH**: Média das notas de Ciências Humanas;

* **NU_MEDIA_LP**: Média das notas de Linguagens e Códigos;

* **NU_MEDIA_MT**: Média das notas de Matemática;

* **NU_MEDIA_RED**: Média das notas de Redação.

Ressaltamos que para a realização da análise modificamos a variável **TP_DEPENDENCIA_ADM_ESCOLA** que originalmente é codificada como: 1 - Federal, 2 - Estadual, 3 - Municipal e 4 - Privada para 1 - Privada e 2 - Pública. De modo que as categorias administrativas Federal, Estadual e Municipal foram unificadas na categoria Pública.  
Além disso, restringimos a análise ao período entre os anos de 2011 a 2015. Pois, segundo @inep a partir da edição de 2011 a taxa de participação necessária para divulgação do desempenho no ENEM por escola aumentou para 50$\%$. Sendo que, a taxa de participação é o número total de participantes no ENEM da escola dividido pelo número de matriculados nos anos finais do Ensino Médio da escola, informado no Censo Escolar. Bem como, passou a ser considerado como participante o estudante concluinte do ensino médio que fez as 4 áreas de conhecimento e redação. Dessa forma, não havendo mais escolas com resultado divulgado sem média das notas de redação.

# Analise exploratória

```{r}
# ALTERAR O CAMINHO PARA O DIRETORIO NO QUAL O ARQUIVO "MICRODADOS_ENEM_ESCOLA.csv" 
# ESTA SALVO NO SEU COMPUTADOR
# NAO SALVE OS DADOS NO MESMO DIRETORIO QUE ESTA O ARQUIVO enem_data_analysis.Rmd
# QUE FOI IMPORTADO DO GITHUB

# IMPORTA OS DADOS
escolas <- read.csv("MICRODADOS_ENEM_ESCOLA.csv", sep = ";")

# TRANSFORMA A VARIAVEL SOBRE DEPENDENCIA ADMINISTRATIVA EM FATOR
escolas$TP_DEPENDENCIA_ADM_ESCOLA <- if_else(escolas$TP_DEPENDENCIA_ADM_ESCOLA == 4,
                                             "Privada","Pública")
escolas$TP_DEPENDENCIA_ADM_ESCOLA <- as.factor(escolas$TP_DEPENDENCIA_ADM_ESCOLA)

# FILTRA OS DADOS DE 2011 A 2015
escolas <- escolas %>% filter(NU_ANO > 2010)

# ALTERA OS NOMES DAS COLUNAS QUE APARECERAM NAS TABELAS
colnames(escolas) <- ifelse(colnames(escolas) == "NU_ANO",
                            "Ano",colnames(escolas))
colnames(escolas) <- ifelse(colnames(escolas) == "TP_DEPENDENCIA_ADM_ESCOLA",
                            "Administração",colnames(escolas))
```

Dada a forma como estruturamos os dados descrita na seção Banco de dados obtemos `r table(escolas$Administração == "Pública")[2]` escolas públicas e `r table(escolas$Administração == "Privada")[2]` escolas privadas que participaram das edições de 2011 a 2015 do ENEM por escola.  
Considerando as informações 

```{r CN}
#TABELA RESUMO DOS VALORES OBSERVADOS DA VARIAVEL NOTAS MEDIAS EM CIENCIAS DA NATUREZA
escolas %>% group_by(Ano,`Administração`) %>%
  summarize(Mínimo = min(NU_MEDIA_CN,na.rm = T),
            `1ºQuartil` = round(quantile(NU_MEDIA_CN, 0.25,na.rm = T),2),
            Mediana = round(median(NU_MEDIA_CN,na.rm = T),2),
            Média = round(mean(NU_MEDIA_CN,na.rm = T),2),
            `3ºQuartil` = round(quantile(NU_MEDIA_CN,0.75,na.rm = T),2),
            Máximo = max(NU_MEDIA_CN,na.rm = T),
            `Desvio Padrão` = round(sd(NU_MEDIA_CN,na.rm = T),2)
            ) %>% 
  kable(booktabs = TRUE, 
        caption = "Comparação entre os anos de 2011 a 2015 das medidas resumo das notas médias em Ciências da Natureza considerando as categorias administrativas das escolas.") %>%
  kable_styling(latex_options = "HOLD_position",
                font_size = 8) %>% 
  kable_styling(latex_options = "scale_down")
```

```{r CH}
#TABELA RESUMO DOS VALORES OBSERVADOS DA VARIAVEL NOTAS MEDIAS EM CIENCIAS HUMANAS
escolas %>% group_by(Ano,`Administração`) %>%
  summarize(Mínimo = min(NU_MEDIA_CH,na.rm = T),
            `1ºQuartil` = round(quantile(NU_MEDIA_CH, 0.25,na.rm = T),2),
            Mediana = round(median(NU_MEDIA_CH,na.rm = T),2),
            Média = round(mean(NU_MEDIA_CH,na.rm = T),2),
            `3ºQuartil` = round(quantile(NU_MEDIA_CH,0.75,na.rm = T),2),
            Máximo = max(NU_MEDIA_CH,na.rm = T),
            `Desvio Padrão` = round(sd(NU_MEDIA_CH,na.rm = T),2)
            ) %>% 
  kable(booktabs = TRUE, 
        caption = "Comparação entre os anos de 2011 a 2015 das medidas resumo das notas médias em Ciências Humanas considerando as categorias administrativas das escolas.") %>%
  kable_styling(latex_options = "HOLD_position",
                font_size = 8) %>% 
  kable_styling(latex_options = "scale_down")
```

```{r LP}
#TABELA RESUMO DOS VALORES OBSERVADOS DA VARIAVEL NOTAS MEDIAS EM LINGUAGENS E CODIGOS
escolas %>% group_by(Ano,`Administração`) %>%
  summarize(Mínimo = min(NU_MEDIA_LP,na.rm = T),
            `1ºQuartil` = round(quantile(NU_MEDIA_LP, 0.25,na.rm = T),2),
            Mediana = round(median(NU_MEDIA_LP,na.rm = T),2),
            Média = round(mean(NU_MEDIA_LP,na.rm = T),2),
            `3ºQuartil` = round(quantile(NU_MEDIA_LP,0.75,na.rm = T),2),
            Máximo = max(NU_MEDIA_LP,na.rm = T),
            `Desvio Padrão` = round(sd(NU_MEDIA_LP,na.rm = T),2)
            ) %>% 
  kable(booktabs = TRUE, 
        caption = "Comparação entre os anos de 2011 a 2015 das medidas resumo das notas médias em Linguagens e Códigos considerando as categorias administrativas das escolas.") %>%
  kable_styling(latex_options = "HOLD_position",
                font_size = 8) %>% 
  kable_styling(latex_options = "scale_down")
```

```{r MT}
#TABELA RESUMO DOS VALORES OBSERVADOS DA VARIAVEL NOTAS MEDIAS EM MATEMATICA
escolas %>% group_by(Ano,`Administração`) %>%
  summarize(Mínimo = min(NU_MEDIA_MT,na.rm = T),
            `1ºQuartil` = round(quantile(NU_MEDIA_MT, 0.25,na.rm = T),2),
            Mediana = round(median(NU_MEDIA_MT,na.rm = T),2),
            Média = round(mean(NU_MEDIA_MT,na.rm = T),2),
            `3ºQuartil` = round(quantile(NU_MEDIA_MT,0.75,na.rm = T),2),
            Máximo = max(NU_MEDIA_MT,na.rm = T),
            `Desvio Padrão` = round(sd(NU_MEDIA_MT,na.rm = T),2)
            ) %>% 
  kable(booktabs = TRUE, 
        caption = "Comparação entre os anos de 2011 a 2015 das medidas resumo das notas médias em Matemática considerando as categorias administrativas das escolas.") %>%
  kable_styling(latex_options = "HOLD_position",
                font_size = 8) %>% 
  kable_styling(latex_options = "scale_down")
```

```{r RED}
#TABELA RESUMO DOS VALORES OBSERVADOS DA VARIAVEL NOTAS MEDIAS NA REDACAO
escolas %>% group_by(Ano,`Administração`) %>%
  summarize(Mínimo = min(NU_MEDIA_RED,na.rm = T),
            `1ºQuartil` = round(quantile(NU_MEDIA_RED, 0.25,na.rm = T),2),
            Mediana = round(median(NU_MEDIA_RED,na.rm = T),2),
            Média = round(mean(NU_MEDIA_RED,na.rm=T),2),
            `3ºQuartil` = round(quantile(NU_MEDIA_RED,0.75,na.rm = T),2),
            Máximo = max(NU_MEDIA_RED,na.rm = T),
            `Desvio Padrão` = round(sd(NU_MEDIA_RED,na.rm = T),2)
            ) %>% 
  kable(booktabs = TRUE, 
        caption = "Comparação entre os anos de 2011 a 2015 das medidas resumo das notas médias na Redação considerando as categorias administrativas das escolas.") %>%
  kable_styling(latex_options = "HOLD_position",
                font_size = 8) %>% 
  kable_styling(latex_options = "scale_down")
```

```{r include=FALSE}
# PREPARA DOS DADOS PARA GERAR OS GRAFICOS
data <- escolas %>% 
  dplyr::select(NU_MEDIA_CN,
                NU_MEDIA_CH,
                NU_MEDIA_LP,
                NU_MEDIA_MT,
                NU_MEDIA_RED) %>% t() %>% as.data.frame() 
data$Habilidades <- ifelse(row.names(data) == "NU_MEDIA_CN","Ciências da Natureza",
                           ifelse(row.names(data) == "NU_MEDIA_CH","Ciências Humanas",
                                  ifelse(row.names(data) == "NU_MEDIA_LP","Linguagens e Códigos",
                                         ifelse(row.names(data) == "NU_MEDIA_MT","Matemática","Redação"))))
data <- melt(data,id="Habilidades")
data$`Administração` <- rep(escolas$Administração,rep(5,length(escolas$Administração)))
data$Ano <- rep(escolas$Ano,rep(5,length(escolas$Ano)))
```

```{r plot, fig.align='center', fig.cap="Comparação das distribuições amostrais das notas médias obtidas no ENEM por estudantes de escolas públicas e privadas de todo o país entre os anos de 2011 a 2015.",fig.pos="H", message=FALSE, error=FALSE}

data %>% 
  ggplot() + 
  aes(x=value, 
      color=Habilidades) + 
  geom_density() +
  facet_grid(Ano~Administração,scales = "free") +
  theme_minimal() + 
  theme(axis.text.x = element_text(size = 8),
        axis.text.y = element_blank(),
        axis.title = element_text(size = 8),
        title = element_text(size = 9)) +
  ggtitle("Distribuições amostrais das notas médias obtidas no ENEM\nentre os anos de 2011 a 2015 de estudantes de escolas públicas e privadas ") +
  xlab("Notas médias") + 
  ylab("Densidades")
```

# Considerações finais

# Referências